<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head profile="http://www.w3.org/2000/08/w3c-synd/#">
  <meta charset="UTF-8">
  <link rel="stylesheet" href="attachments/site.css" type="text/css"/>
  <link rel="shortcut icon" href="attachments/favicon.ico"/>
  <link rel="icon" type="image/x-icon" href="attachments/favicon.ico"/>

  <title>Codehaus Cargo - Jetty Remote Deployer</title>

  <script type="text/javascript">
    // Google Analytics code

    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-31476258-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>

  <script type="text/javascript">
    if (location.href.indexOf("http://") === 0) {
      location.replace("https://" + location.href.substring(7));
    }
  </script>
</head>

<body>
  <table width="100%" id="layout" style="padding:0px;margin0px;border-collapse:collapse;">
    <tr>
      <td colspan="2" style="padding:8px;">
        <table width="100%" id="banner" style="padding:0px;margin:0px">
          <tr background="attachments/cargo-banner-center.png">
            <td align="left" valign="middle" style="padding:0px;margin:0px;" background="attachments/cargo-banner-center.png">
              <img src="attachments/cargo-banner-left.png"/>
            </td>
            <td align="right" valign="middle" style="padding:0px;margin:0px;" background="attachments/cargo-banner-center.png">
              <img src="attachments/cargo-banner-right.png"/>
            </td>
          </tr>
        </table>
      </td>
    </tr>
    <tr>
      <td colspan="2" id="breadcrumbs">
        <!--
        <table width="100%" id="banner" style="padding:0px;margin:0px">
          <tr>
            <td align="left">
              <p>
                <a href="/">Home</a>
                #if ($page.pageKey != "Home")
                  #foreach($breadcrumb in $breadcrumbs)
                    &gt; <a href="/${breadcrumb.pageKeyEncoded}">${breadcrumb.pageKey}</a>
                  #end
                #end
              </p>
            </td>
            <td align="left">
              #if (${quicklinksFragment})
                ${quicklinksFragment}
              #end
            </td>
            <td align="right">
              <a href="/${page.pageKeyEncoded}?print=1" style="color:#999;font-size:small">
                <img src="attachments/print.gif" border="0" alt="Printable version" title="Printable version">
              </a>
            </td>
          </tr>
        </table>
         -->
      </td>
    </tr>
    <tr>
      <td id="leftColumn" valign="top" style="padding-top: 0px;">
          <h3 id="Navigation-QuickLinks">Quick Links</h3><ul class="alternate"><li><a href="Home.html">Home</a></li><li><a href="Downloads.html">Downloads</a></li><li><a href="Quick+start.html">Quick start</a></li><li><a href="Contributing.html">How to contribute?</a><ul class="alternate"><li><a href="Adding+a+container.html">Adding a container</a></li></ul></li></ul><h3 class="confluence-link" id="Navigation-Documentation">Documentation</h3><ul class="alternate"><li>Overview<br /><ul class="alternate"><li><a href="Architecture.html">Architecture</a></li><li><a href="Features.html">Features</a></li></ul></li><li><a href="Installation.html">Installation</a></li><li>Usage<br /><ul class="alternate"><li><a href="Javadocs.html">Java API</a></li><li><a href="Functional+testing.html">Functional testing with JUnit</a></li><li><a href="Ant+support.html">Ant tasks</a></li><li><a href="Maven2+plugin.html">Maven2/Maven3 plugin</a></li><li><a href="Cargo+Daemon.html">Cargo Daemon</a></li></ul></li><li><a href="Articles.html">Articles</a></li><li><a href="License.html">License</a></li><li><a href="Credits.html">Credits</a></li></ul><h3 id="Navigation-Containers">Containers</h3><ul class="alternate"><li>Geronimo<ul class="alternate"><li><a href="Geronimo+1.x.html">Geronimo 1.x</a></li><li><a href="Geronimo+2.x.html">Geronimo 2.x</a></li><li><a href="Geronimo+3.x.html">Geronimo 3.x</a></li></ul></li></ul><ul class="alternate"><li>Glassfish<ul class="alternate"><li><a href="Glassfish+2.x.html">Glassfish 2.x</a></li><li><a href="Glassfish+3.x.html">Glassfish 3.x</a></li><li><a href="Glassfish+4.x.html">Glassfish 4.x</a></li></ul></li></ul><ul class="alternate"><li>JBoss<ul class="alternate"><li><a href="JBoss+3.x.html">JBoss 3.x</a></li><li><a href="JBoss+4.x.html">JBoss 4.x</a></li><li><a href="JBoss+4.2.x.html">JBoss 4.2.x</a></li><li><a href="JBoss+5.x.html">JBoss 5.x</a></li><li><a href="JBoss+5.1.x.html">JBoss 5.1.x</a></li><li><a href="JBoss+6.x.html">JBoss 6.x</a></li><li><a href="JBoss+6.1.x.html">JBoss 6.1.x</a></li><li><a href="JBoss+7.x.html">JBoss 7.x</a></li><li><a href="JBoss+7.1.x.html">JBoss 7.1.x</a></li><li><a href="JBoss+7.2.x.html">JBoss 7.2.x</a></li><li><a href="JBoss+7.3.x.html">JBoss 7.3.x</a></li><li><a href="JBoss+7.4.x.html">JBoss 7.4.x</a></li></ul></li></ul><ul class="alternate"><li>Jetty<ul class="alternate"><li><a href="Jetty+4.x.html">Jetty 4.x</a></li><li><a href="Jetty+5.x.html">Jetty 5.x</a></li><li><a href="Jetty+6.x.html">Jetty 6.x</a></li><li><a href="Jetty+7.x.html">Jetty 7.x</a></li><li><a href="Jetty+8.x.html">Jetty 8.x</a></li><li><a href="Jetty+9.x.html">Jetty 9.x</a></li></ul></li></ul><ul class="alternate"><li>Jo!<ul class="alternate"><li><a href="jo+1.x.html">jo 1.x</a></li></ul></li></ul><ul class="alternate"><li>JOnAS<ul class="alternate"><li><a href="JOnAS+4.x.html">JOnAS 4.x</a></li><li><a href="JOnAS+5.x.html">JOnAS 5.x</a></li></ul></li></ul><ul class="alternate"><li>JRun<ul class="alternate"><li><a href="JRun+4.x.html">JRun 4.x</a></li></ul></li></ul><ul class="alternate"><li>Orion/OC4J<ul class="alternate"><li><a href="Oc4J+9.x.html">Oc4J 9.x</a></li><li><a href="Oc4j+10.x.html">Oc4j 10.x</a></li></ul></li></ul><ul class="alternate"><li>Resin<ul class="alternate"><li><a href="Resin+2.x.html">Resin 2.x</a></li><li><a href="Resin+3.x.html">Resin 3.x</a></li><li><a href="Resin+3.1.x.html">Resin 3.1.x</a></li><li><a href="Resin+4.x.html">Resin 4.x</a></li></ul></li></ul><ul class="alternate"><li>Tomcat<ul class="alternate"><li><a href="Tomcat+4.x.html">Tomcat 4.x</a></li><li><a href="Tomcat+5.x.html">Tomcat 5.x</a></li><li><a href="Tomcat+6.x.html">Tomcat 6.x</a></li><li><a href="Tomcat+7.x.html">Tomcat 7.x</a></li><li><a href="Tomcat+8.x.html">Tomcat 8.x</a></li></ul></li></ul><ul class="alternate"><li>TomEE<ul class="alternate"><li><a href="TomEE+1.x.html">TomEE 1.x</a></li></ul></li></ul><ul class="alternate"><li>WebLogic<br /><ul class="alternate"><li><a href="WebLogic+8.x.html">WebLogic 8.x</a></li><li><a href="WebLogic+9.x.html">WebLogic 9.x</a></li><li><a href="WebLogic+10.x.html">WebLogic 10.x</a></li><li><a href="WebLogic+10.3.x.html">WebLogic 10.3.x</a></li><li><a href="WebLogic+12.x.html">WebLogic 12.x</a></li><li><a href="WebLogic+12.1.x.html">WebLogic 12.1.x</a></li></ul></li></ul><ul class="alternate"><li>WebSphere<br /><ul class="alternate"><li><a href="WebSphere+8.5.x.html">WebSphere 8.5.x</a></li></ul></li></ul><ul class="alternate"><li>WildFly<br /><ul class="alternate"><li><a href="WildFly+8.x.html">WildFly 8.x</a></li></ul></li></ul><h3 id="Navigation-Extensions">Extensions</h3><ul class="alternate"><li><a href="Ant+support.html">Ant</a></li><li><a href="Cargo+Daemon.html">Cargo Daemon</a></li><li><a href="Maven2+plugin.html">Maven2/Maven3</a></li></ul><p>Independent extensions:</p><ul class="alternate"><li><a href="https://github.com/bmuschko/gradle-cargo-plugin" class="external-link" rel="nofollow">Gradle</a></li><li><a href="https://github.com/mulesoft/cargo-mule-container" class="external-link" rel="nofollow">Mule container</a></li></ul><h3 id="Navigation-ProjectInfo">Project Info</h3><ul class="alternate"><li><a href="Roadmap.html">Roadmap</a></li><li><a href="News.html">News</a></li><li><a href="https://jira.codehaus.org/browse/CARGO?report=com.atlassian.jira.plugin.system.project:openissues-panel" class="external-link" rel="nofollow">Issues</a></li><li><a href="https://jira.codehaus.org/browse/CARGO?report=com.atlassian.jira.plugin.system.project:changelog-panel" class="external-link" rel="nofollow">Change log</a></li><li><a href="SVN.html">SVN</a></li><li><a href="Mailing+Lists.html">Mailing Lists</a></li><li><a href="License.html">License</a></li><li><a href="Credits.html">Credits</a></li></ul><h3 id="Navigation-GetInvolved">Get Involved</h3><ul class="alternate"><li><a href="Contributing.html">Contributing</a></li><li><a href="Discussions.html">Discussions</a></li></ul><h3 id="Navigation-Development">Development</h3><ul class="alternate"><li><a href="Cargo+Code+Style.html">Cargo Code Style</a></li><li><a href="Project+Structure.html">Project Structure</a></li><li><a href="Importing+sources.html">Importing sources</a></li><li><a href="Building.html">Building</a></li><li><a href="Release+procedure.html">Release procedure</a></li><li><a href="https://semaphoreci.com/codehaus-cargo/cargo" class="external-link" rel="nofollow">Continous Integration</a><br /><a href="https://semaphoreci.com/codehaus-cargo/cargo" class="external-link" rel="nofollow"><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="attachments/shields_badge.svg" data-image-src="attachments/shields_badge.svg"></span></a></li></ul>

          <h3 class="heading3">Feeds</h3>
          <table border="0" cellspacing="4px">
          <tr>
            <td align="right">
              <a href="https://codehaus-cargo.atlassian.net/wiki/collector/pages.action?key=CARGO"><img src="attachments/rss.gif" border="0"></a><br/>
            </td>
            <td align="left">
              <a href="https://codehaus-cargo.atlassian.net/wiki/collector/pages.action?key=CARGO">Site</a>
            </td>
          </tr>
          <tr>
            <td align="right">
              <a href="https://codehaus-cargo.atlassian.net/wiki/pages/viewrecentblogposts.action?key=CARGO"><img src="attachments/rss.gif" border="0"></a>
            </td>
            <td align="left">
              <a href="https://codehaus-cargo.atlassian.net/wiki/pages/viewrecentblogposts.action?key=CARGO">News</a>
            </td>
          </tr>
        </table>
      </td>
      <td id="rightColumn" valign="top">
        <script type="text/javascript">
          // Google Ads code
          google_ad_client = "ca-pub-7996505557003356";
          google_ad_slot = "5363897989";
          google_ad_width = 728;
          google_ad_height = 90;
        </script>
        <center style="padding-bottom: 1mm; margin-bottom: 2mm; border: 1px solid #eee">
          <script type="text/javascript" src="https://pagead2.googlesyndication.com/pagead/show_ads.js">
          </script>
        </center>

        <p>This document explains how to configure Cargo remote deployment support on a Jetty container.</p><h3 id="JettyRemoteDeployer-Overview">Overview</h3><p>By default, Jetty does not come with possibilities for remote deployment. In order to add such a support to Jetty, Cargo uses a &quot;Jetty remote deployer&quot; Web application.</p><p>This application is a simple servlet-based application which exposes methods such as deploy or undeploy on standard HTTP POST URLs. When thse HTTP methods are called, the servlet implementing these methods connects to the Jetty Server implementation and does deployment related actions on the server; this Web application can therefore be seen as a kind of remote administration proxy.</p><p>Being a standard Web application, the Cargo Jetty remote deployer application can be secured using Jetty users and roles.</p><h3 id="JettyRemoteDeployer-Downloadingtheremotedeployer">Downloading the remote deployer</h3><p>Two versions of the Jetty remote deployer WAR are available on the <a href="Downloads.html">Cargo downloads</a> page (scroll down to the <strong>Tools</strong> section):</p><ul><li><code>cargo-jetty-7-and-onwards-deployer</code>: The Deployer Web application for the Jetty remote containers, which must have been deployed to Jetty before using the CARGO remote deployer. Designed to work with Jetty 7.x and later (Jetty from Eclipse.org)</li><li><code>cargo-jetty-6-and-earlier-deployer</code>: The Deployer Web application for the Jetty remote containers, which must have been deployed to Jetty before using the CARGO remote deployer. Designed to work with Jetty 6.x and earlier (Jetty from Mortbay.org)</li></ul><p>Please make sure to download and install the correct flavour for your Jetty version.</p><h3 id="JettyRemoteDeployer-Security">Security</h3><p>By default, the Cargo Jetty remote deployer comes with no security.</p><p>In order to activate security, follow these steps:</p><ol><li>Open the <code>WEB-INF/web.xml</code> file of the Cargo Jetty remote deployer WAR</li><li>Uncomment the part that says <code>Uncomment in order to activate security</code>. By default, that configuration is as follows:<ul><li>Authentication is done using standard HTTP headers: <code>login-config</code> set to <code>BASIC</code>.</li><li>Authorization is done using Jetty role: <code>security-constraint</code> has a <code>auth-constraint</code> with <code>role-name</code>.</li></ul></li><li>Create a user with the Jetty role <code>manager</code>:<ol><li>Open the Jetty <code>realm.properties</code> file</li><li><p>Add, for example, the following definition</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre>someusername: somepassword,manager
</pre>
</div></div></li></ol></li></ol><p>To try the security settings, you can try to visit the <code>/cargo-jetty-deployer</code> context on your server, for example <a href="http://production27:8080/cargo-jetty-deployer" class="external-link" rel="nofollow">http://production27:8080/cargo-jetty-deployer</a>, using any Web browser. If security is configured well, it should:</p><ul><li>Ask for a login and password</li><li>Ask again if the login is not valid</li><li>If the login is valid, show a page saying: <code>Command / is unknown</code></li></ul><div class="confluence-information-macro confluence-information-macro-tip"><span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span><div class="confluence-information-macro-body"><p><strong>Note</strong>: Jetty's website has documentation on hashing the password.</p></div></div><h3 id="JettyRemoteDeployer-Examples">Examples</h3><p>Here is an example Maven2 plugin configuration that:</p><ul><li>Deploys on a remote Jetty 6.x server</li><li>The server is on <code>production17</code>, port <code>8080</code></li><li>The Jetty remote deployer WAR is secured using the Jetty role <code>manager</code></li><li>A user called <code>someusername</code> with password <code>somepassword</code> is defined as <code>manager</code></li></ul><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre>&lt;dependencies&gt;
  &lt;dependency&gt;
    &lt;groupId&gt;test.somegroup&lt;/groupId&gt;
    &lt;artifactId&gt;somewar&lt;/artifactId&gt;
    &lt;version&gt;1.0.0&lt;/version&gt;
    &lt;type&gt;war&lt;/type&gt;
  &lt;/dependency&gt;
&lt;/dependencies&gt;

...

&lt;plugins&gt;
  &lt;plugin&gt;
    &lt;groupId&gt;org.codehaus.cargo&lt;/groupId&gt;
    &lt;artifactId&gt;cargo-maven2-plugin&lt;/artifactId&gt;
    &lt;version&gt;${cargo.plugin.version}&lt;/version&gt;
    &lt;configuration&gt;
      &lt;container&gt;
        &lt;containerId&gt;jetty6x&lt;/containerId&gt;
        &lt;type&gt;remote&lt;/type&gt;
      &lt;/container&gt;

      &lt;configuration&gt;
        &lt;type&gt;runtime&lt;/type&gt;
        &lt;properties&gt;
          &lt;cargo.hostname&gt;production17&lt;/cargo.hostname&gt;
          &lt;cargo.servlet.port&gt;8080&lt;/cargo.servlet.port&gt;
          &lt;cargo.remote.username&gt;someusername&lt;/cargo.remote.username&gt;
          &lt;cargo.remote.password&gt;somepassword&lt;/cargo.remote.password&gt;
        &lt;/properties&gt;
      &lt;/configuration&gt;

      &lt;deployer&gt;
        &lt;type&gt;remote&lt;/type&gt;
      &lt;/deployer&gt;

      &lt;deployables&gt;
        &lt;deployable&gt;
          &lt;groupId&gt;test.somegroup&lt;/groupId&gt;
          &lt;artifactId&gt;somewar&lt;/artifactId&gt;
          &lt;type&gt;war&lt;/type&gt;
          &lt;properties&gt;
            &lt;context&gt;/myAppContext&lt;/context&gt;
          &lt;/properties&gt;
        &lt;/deployable&gt;
      &lt;/deployables&gt;
    &lt;/configuration&gt;
  &lt;/plugin&gt;
&lt;/plugins&gt;
</pre>
</div></div><p>To run the given Maven2 plugin configuration on a simple Maven2 WAR project, simply execute:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre>mvn war:war
mvn cargo:deploy
</pre>
</div></div><h3 id="JettyRemoteDeployer-Knownissues">Known issues</h3><div class="confluence-information-macro confluence-information-macro-note"><p class="title">Unexpected end of file from server and maxIdleTime parameter</p><span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span><div class="confluence-information-macro-body"><p>By default, Jetty sets the <code>maxIdleTime</code> parameter in the <code>etc/jetty.xml</code> file 30 seconds. This means that if the actual deployment takes more than 30 seconds, you might get error messages like:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre>[ERROR] Failed to execute goal org.codehaus.cargo:cargo-maven2-plugin:1.2.2:deploy (default-cli)
        on project display: Execution default-cli of goal org.codehaus.cargo:cargo-maven2-plugin:1.2.2:deploy
        failed: Failed to deploy [/var/lib/jenkins/workspace/Vanessa-cargo/target/display-1.2.2.1-SNAPSHOT.war]:
        Unexpected end of file from server -&gt; [Help 1]

    ...

Caused by: java.net.SocketException: Unexpected end of file from server
    at sun.net.www.http.HttpClient.parseHTTPHeader(HttpClient.java:770)
    at sun.net.www.http.HttpClient.parseHTTP(HttpClient.java:633)
    at sun.net.www.http.HttpClient.parseHTTPHeader(HttpClient.java:767)
    at sun.net.www.http.HttpClient.parseHTTP(HttpClient.java:633)
    at sun.net.www.protocol.http.HttpURLConnection.getInputStream(HttpURLConnection.java:1162)
    at java.net.HttpURLConnection.getResponseCode(HttpURLConnection.java:397)
    at org.codehaus.cargo.container.jetty.JettyRemoteDeployer.getResponseMessage(JettyRemoteDeployer.java:262)
    at org.codehaus.cargo.container.jetty.JettyRemoteDeployer.deploy(JettyRemoteDeployer.java:113)
    ... 25 more</pre>
</div></div><p>In this case, open the target Jetty container's <code>etc/jetty.xml</code> file and set the <code>maxIdleTime</code> parameter to longer. For example:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre>&lt;?xml version=&quot;1.0&quot;?&gt;
&lt;!DOCTYPE Configure PUBLIC &quot;-//Mort Bay Consulting//DTD Configure//EN&quot; &quot;http://jetty.mortbay.org/configure.dtd&quot;&gt;

&lt;Configure id=&quot;Server&quot; class=&quot;org.mortbay.jetty.Server&quot;&gt;
    ...
  &lt;Call name=&quot;addConnector&quot;&gt;
    &lt;Arg&gt;
      &lt;New class=&quot;org.mortbay.jetty.nio.SelectChannelConnector&quot;&gt;
          ...
        &lt;!-- Set a longer maxIdleTime (90 seconds in this case) to allow long remote deployments --&gt;
        &lt;Set name=&quot;maxIdleTime&quot;&gt;90000&lt;/Set&gt;
          ...
      &lt;/New&gt;
    &lt;/Arg&gt;
  &lt;/Call&gt;
    ...
&lt;/Configure&gt;</pre>
</div></div></div></div>
      </td>
    </tr>
    <tr>
      <td colspan="2" id="footer">
        <table width="100%"> 
          <tr>
            <td align="left" valign="top">
              Copyright 2004-2015. All rights reserved unless otherwise noted.<br/>
            </td>
            <td align="right" valign="top">
              Powered by <a href="https://codehaus-cargo.atlassian.net/wiki/display/CARGO/Jetty+Remote+Deployer">Atlassian Confluence</a>.
            </td>
          </tr>
        <table>
      </td>
    </tr>
  </table>
</body>
</html>
