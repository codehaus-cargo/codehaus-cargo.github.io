<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<head profile="http://www.w3.org/2000/08/w3c-synd/#">
  <link rel="stylesheet" href="attachments/site.css" type="text/css"/>
  <link rel="shortcut icon" href="attachments/favicon.ico"/>
  <link rel="icon" type="image/x-icon" href="attachments/favicon.ico"/>

  <title>Codehaus Cargo - Adding TLD support to the Jetty container</title>

  <script type="text/javascript">
    // Google Analytics code

    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-31476258-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>
</head>

<body>
  <table width="100%" id="layout" style="padding:0px;margin0px;border-collapse:collapse;">
    <tr>
      <td colspan="2" style="padding:8px;">
        <table width="100%" id="banner" style="padding:0px;margin:0px">
          <tr id="header_row">
            <td align="left" valign="middle" style="padding:0px;margin:0px;">
              <img src="attachments/cargo-banner-left.png"/>
            </td>
            <td align="right" valign="middle" style="padding:0px;margin:0px;">
              <img src="attachments/cargo-banner-right.png"/>
            </td>
          </tr>
        </table>
      </td>
    </tr>
    <tr>
      <td colspan="2" id="breadcrumbs">
        <!--
        <table width="100%" id="banner" style="padding:0px;margin:0px">
          <tr>
            <td align="left">
              <p>
                <a href="/">Home</a>
                #if ($page.pageKey != "Home")
                  #foreach($breadcrumb in $breadcrumbs)
                    &gt; <a href="/${breadcrumb.pageKeyEncoded}">${breadcrumb.pageKey}</a>
                  #end
                #end
              </p>
            </td>
            <td align="left">
              #if (${quicklinksFragment})
                ${quicklinksFragment}
              #end
            </td>
            <td align="right">
              <a href="/${page.pageKeyEncoded}?print=1" style="color:#999;font-size:small">
                <img src="attachments/print.gif" border="0" alt="Printable version" title="Printable version">
              </a>
            </td>
          </tr>
        </table>
         -->
      </td>
    </tr>
    <tr>
      <td id="leftColumn" valign="top" style="padding-top: 0px;">
          <h3 id="Navigation-QuickLinks">Quick Links</h3><ul class="alternate"><li><a href="Home.html">Home</a></li><li><a href="Downloads.html">Downloads</a></li><li><a href="Quick+start.html">Quick start</a></li><li><a href="Contributing.html">How to contribute?</a><ul class="alternate"><li><a href="Adding+a+container.html">Adding a container</a></li></ul></li></ul><h3 class="confluence-link" id="Navigation-Documentation">Documentation</h3><ul class="alternate"><li>Overview<br /><ul class="alternate"><li><a href="Architecture.html">Architecture</a></li><li><a href="Features.html">Features</a></li></ul></li><li><a href="Installation.html">Installation</a></li><li>Usage<br /><ul class="alternate"><li><a href="Javadocs.html">Java API</a></li><li><a href="Functional+testing.html">Functional testing with JUnit</a></li><li><a href="Ant+support.html">Ant tasks</a></li><li><a href="Maven2+plugin.html">Maven2/Maven3 plugin</a></li><li><a href="Cargo+Daemon.html">Cargo Daemon</a></li></ul></li><li><a href="Articles.html">Articles</a></li><li><a href="License.html">License</a></li><li><a href="Credits.html">Credits</a></li></ul><h3 id="Navigation-Containers">Containers</h3><ul class="alternate"><li>Geronimo<ul class="alternate"><li><a href="Geronimo+1.x.html">Geronimo 1.x</a></li><li><a href="Geronimo+2.x.html">Geronimo 2.x</a></li><li><a href="Geronimo+3.x.html">Geronimo 3.x</a></li></ul></li></ul><ul class="alternate"><li>Glassfish<ul class="alternate"><li><a href="Glassfish+2.x.html">Glassfish 2.x</a></li><li><a href="Glassfish+3.x.html">Glassfish 3.x</a></li><li><a href="Glassfish+4.x.html">Glassfish 4.x</a></li></ul></li></ul><ul class="alternate"><li>JBoss<ul class="alternate"><li><a href="JBoss+3.x.html">JBoss 3.x</a></li><li><a href="JBoss+4.x.html">JBoss 4.x</a></li><li><a href="JBoss+4.2.x.html">JBoss 4.2.x</a></li><li><a href="JBoss+5.x.html">JBoss 5.x</a></li><li><a href="JBoss+5.1.x.html">JBoss 5.1.x</a></li><li><a href="JBoss+6.x.html">JBoss 6.x</a></li><li><a href="JBoss+6.1.x.html">JBoss 6.1.x</a></li><li><a href="JBoss+7.x.html">JBoss 7.x</a></li><li><a href="JBoss+7.1.x.html">JBoss 7.1.x</a></li><li><a href="JBoss+7.2.x.html">JBoss 7.2.x</a></li><li><a href="JBoss+7.3.x.html">JBoss 7.3.x</a></li><li><a href="JBoss+7.4.x.html">JBoss 7.4.x</a></li></ul></li></ul><ul class="alternate"><li>Jetty<ul class="alternate"><li><a href="Jetty+4.x.html">Jetty 4.x</a></li><li><a href="Jetty+5.x.html">Jetty 5.x</a></li><li><a href="Jetty+6.x.html">Jetty 6.x</a></li><li><a href="Jetty+7.x.html">Jetty 7.x</a></li><li><a href="Jetty+8.x.html">Jetty 8.x</a></li><li><a href="Jetty+9.x.html">Jetty 9.x</a></li></ul></li></ul><ul class="alternate"><li>Jo!<ul class="alternate"><li><a href="jo+1.x.html">jo 1.x</a></li></ul></li></ul><ul class="alternate"><li>JOnAS<ul class="alternate"><li><a href="JOnAS+4.x.html">JOnAS 4.x</a></li><li><a href="JOnAS+5.x.html">JOnAS 5.x</a></li></ul></li></ul><ul class="alternate"><li>JRun<ul class="alternate"><li><a href="JRun+4.x.html">JRun 4.x</a></li></ul></li></ul><ul class="alternate"><li>Orion/OC4J<ul class="alternate"><li><a href="Oc4J+9.x.html">Oc4J 9.x</a></li><li><a href="Oc4j+10.x.html">Oc4j 10.x</a></li></ul></li></ul><ul class="alternate"><li>Resin<ul class="alternate"><li><a href="Resin+2.x.html">Resin 2.x</a></li><li><a href="Resin+3.x.html">Resin 3.x</a></li><li><a href="Resin+3.1.x.html">Resin 3.1.x</a></li><li><a href="Resin+4.x.html">Resin 4.x</a></li></ul></li></ul><ul class="alternate"><li>Tomcat<ul class="alternate"><li><a href="Tomcat+4.x.html">Tomcat 4.x</a></li><li><a href="Tomcat+5.x.html">Tomcat 5.x</a></li><li><a href="Tomcat+6.x.html">Tomcat 6.x</a></li><li><a href="Tomcat+7.x.html">Tomcat 7.x</a></li><li><a href="Tomcat+8.x.html">Tomcat 8.x</a></li></ul></li></ul><ul class="alternate"><li>TomEE<ul class="alternate"><li><a href="TomEE+1.x.html">TomEE 1.x</a></li></ul></li></ul><ul class="alternate"><li>WebLogic<br /><ul class="alternate"><li><a href="WebLogic+8.x.html">WebLogic 8.x</a></li><li><a href="WebLogic+9.x.html">WebLogic 9.x</a></li><li><a href="WebLogic+10.x.html">WebLogic 10.x</a></li><li><a href="WebLogic+10.3.x.html">WebLogic 10.3.x</a></li><li><a href="WebLogic+12.x.html">WebLogic 12.x</a></li><li><a href="WebLogic+12.1.x.html">WebLogic 12.1.x</a></li></ul></li></ul><ul class="alternate"><li>WebSphere<br /><ul class="alternate"><li><a href="WebSphere+8.5.x.html">WebSphere 8.5.x</a></li></ul></li></ul><ul class="alternate"><li>WildFly<br /><ul class="alternate"><li><a href="WildFly+8.x.html">WildFly 8.x</a></li></ul></li></ul><h3 id="Navigation-Extensions">Extensions</h3><ul class="alternate"><li><a href="Ant+support.html">Ant</a></li><li><a href="Cargo+Daemon.html">Cargo Daemon</a></li><li><a href="Maven2+plugin.html">Maven2/Maven3</a></li></ul><p>Independent extensions:</p><ul class="alternate"><li><a href="https://github.com/bmuschko/gradle-cargo-plugin" class="external-link" rel="nofollow">Gradle</a></li><li><a href="https://github.com/mulesoft/cargo-mule-container" class="external-link" rel="nofollow">Mule container</a></li></ul><h3 id="Navigation-ProjectInfo">Project Info</h3><ul class="alternate"><li><a href="Roadmap.html">Roadmap</a></li><li><a href="News.html">News</a></li><li><a href="https://jira.codehaus.org/browse/CARGO?report=com.atlassian.jira.plugin.system.project:openissues-panel" class="external-link" rel="nofollow">Issues</a></li><li><a href="https://jira.codehaus.org/browse/CARGO?report=com.atlassian.jira.plugin.system.project:changelog-panel" class="external-link" rel="nofollow">Change log</a></li><li><a href="SVN.html">SVN</a></li><li><a href="Mailing+Lists.html">Mailing Lists</a></li><li><a href="License.html">License</a></li><li><a href="Credits.html">Credits</a></li></ul><h3 id="Navigation-GetInvolved">Get Involved</h3><ul class="alternate"><li><a href="Contributing.html">Contributing</a></li><li><a href="Discussions.html">Discussions</a></li></ul><h3 id="Navigation-Development">Development</h3><ul class="alternate"><li><a href="Cargo+Code+Style.html">Cargo Code Style</a></li><li><a href="Project+Structure.html">Project Structure</a></li><li><a href="Importing+sources.html">Importing sources</a></li><li><a href="Building.html">Building</a></li><li><a href="Release+procedure.html">Release procedure</a></li><li><a href="https://semaphoreci.com/codehaus-cargo/cargo" class="external-link" rel="nofollow">Continous Integration</a><br /><a href="https://semaphoreci.com/codehaus-cargo/cargo" class="external-link" rel="nofollow"><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image confluence-external-resource" src="attachments/shields_badge.svg" data-image-src="attachments/shields_badge.svg"></span></a></li></ul>

          <h3 class="heading3">Feeds</h3>
          <table border="0" cellspacing="4px">
          <tr>
            <td align="right">
              <a href="https://codehaus-cargo.atlassian.net/wiki/collector/pages.action?key=CARGO"><img src="attachments/rss.gif" border="0"></a><br/>
            </td>
            <td align="left">
              <a href="https://codehaus-cargo.atlassian.net/wiki/collector/pages.action?key=CARGO">Site</a>
            </td>
          </tr>
          <tr>
            <td align="right">
              <a href="https://codehaus-cargo.atlassian.net/wiki/pages/viewrecentblogposts.action?key=CARGO"><img src="attachments/rss.gif" border="0"></a>
            </td>
            <td align="left">
              <a href="https://codehaus-cargo.atlassian.net/wiki/pages/viewrecentblogposts.action?key=CARGO">News</a>
            </td>
          </tr>
        </table>
      </td>
      <td id="rightColumn" valign="top">
        <script type="text/javascript">
          // Google Ads code
          google_ad_client = "ca-pub-7996505557003356";
          google_ad_slot = "5363897989";
          google_ad_width = 728;
          google_ad_height = 90;
        </script>
        <center style="padding-bottom: 1mm; margin-bottom: 2mm; border: 1px solid #eee">
          <script type="text/javascript" src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
          </script>
        </center>

        <h1 id="AddingTLDsupporttotheJettycontainer-Symptoms">Symptoms</h1>

<p>The embedded jetty container  starting up for integration tests in a separate module fails to  successfully run web apps which use tag libraries. The app server starts  successfully however when the test case attempts to hit a jsp which  imports the tag libraries the server fails with the following exception.  This behaviour is not seen when deploying the webapp to an installed  tomcat instance or whe using the jetty maven plugin to start the  container.</p>
<div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre>
org.apache.jasper.JasperException: Unable to initialize
TldLocationsCache: null
	at
org.apache.jasper.compiler.TldLocationsCache.init(TldLocationsCache.java:253)
	at
org.apache.jasper.compiler.TldLocationsCache.getLocation(TldLocationsCache.java:224)
	at
org.apache.jasper.JspCompilationContext.getTldLocation(JspCompilationContext.java:526)
	at
org.apache.jasper.compiler.Parser.parseTaglibDirective(Parser.java:422)
	at org.apache.jasper.compiler.Parser.parseDirective(Parser.java:492)
	at org.apache.jasper.compiler.Parser.parseElements(Parser.java:1552)
	at org.apache.jasper.compiler.Parser.parse(Parser.java:126)
	at
org.apache.jasper.compiler.ParserController.doParse(ParserController.java:211)
	at
org.apache.jasper.compiler.ParserController.parse(ParserController.java:100)
	at org.apache.jasper.compiler.Compiler.generateJava(Compiler.java:155)
	at org.apache.jasper.compiler.Compiler.compile(Compiler.java:295)
	at org.apache.jasper.compiler.Compiler.compile(Compiler.java:276)
	at org.apache.jasper.compiler.Compiler.compile(Compiler.java:264)
	at
org.apache.jasper.JspCompilationContext.compile(JspCompilationContext.java:563)
	at
org.apache.jasper.servlet.JspServletWrapper.service(JspServletWrapper.java:303)
	at
org.apache.jasper.servlet.JspServlet.serviceJspFile(JspServlet.java:314)
	at org.apache.jasper.servlet.JspServlet.service(JspServlet.java:264)
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:820)
</pre>
</div></div>

<h1 id="AddingTLDsupporttotheJettycontainer-Reason">Reason</h1>

<p>For whatever reason, Jetty's thread's context class loader is set to  something other than the webapp classloader when the TldLocationsCache  is first initialized.  The code will try to scan the context classloader for all jars in  WEB-INF/lib, but if the context classloader is set to something else,  the jars won't be found.</p>

<h1 id="AddingTLDsupporttotheJettycontainer-Workaround">Workaround</h1>

<p>The workaround is to place the tld files anywhere in WEB-INF.  The  secondary scan, after the above one, will look for any tld files in  WEB-INF and automatically register them.</p>

<h1 id="AddingTLDsupporttotheJettycontainer-Formoredetails...">For more details...</h1>

<p>See: <a class="external-link" href="https://jira.codehaus.org/browse/CARGO-651" rel="nofollow">https://jira.codehaus.org/browse/CARGO-651</a></p>
      </td>
    </tr>
    <tr>
      <td colspan="2" id="footer">
        <table width="100%"> 
          <tr>
            <td align="left" valign="top">
              Copyright 2004-2015. All rights reserved unless otherwise noted.<br/>
            </td>
            <td align="right" valign="top">
              Powered by <a href="https://codehaus-cargo.atlassian.net/wiki/display/CARGO/Adding+TLD+support+to+the+Jetty+container">Atlassian Confluence</a>.
            </td>
          </tr>
        <table>
      </td>
    </tr>
  </table>
</body>
</html>
